syntax = "proto3";

package backtests;

import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

message BacktestRun {
  uint64 id = 1;
  string backtest_id = 2;
  string source = 3;
  string status = 4;
  optional string user_id = 5;
  optional string api_client_id = 6;
  optional google.protobuf.Timestamp started_at = 12;
  optional google.protobuf.Timestamp finished_at = 13;
  google.protobuf.Struct config = 14;
  uint64 total_iterations = 15;
  uint64 total_permutations = 16;
  google.protobuf.Struct checkpoint = 17;
  google.protobuf.Struct failure_details = 18;
  google.protobuf.Timestamp created_at = 19;
}

message BacktestMintFullResult {
  uint64 id = 1;
  uint64 strategy_result_id = 2;
  uint64 index = 3;
  string mint = 4;
  optional double net_pnl = 5;
  optional double holdings_value = 6;
  optional double roi = 7;
  optional string exit_code = 8;
  optional string exit_reason = 9;
  google.protobuf.Struct payload = 10;
  google.protobuf.Timestamp created_at = 11;
}

message BacktestStrategyFullResult {
  int64 id = 1;
  string backtest_id = 2;
  uint64 backtest_run_id = 3;
  string status = 4;
  string strategy = 5;
  string strategy_id = 6;
  string config_variant = 7;
  google.protobuf.Struct config = 8;
  double pnl_sol = 9;
  double holdings_value_sol = 10;
  double roi = 11;
  double win_rate = 12;
  double wins_count = 13;
  double biggest_win_percentage = 14;
  double losses_count = 15;
  double biggest_loss_percentage = 16;
  uint32 total_trades_count = 17;
  uint32 buy_trades_count = 18;
  uint32 sell_trades_count = 19;
  double highest_peak_sol = 20;
  double lowest_trough_sol = 21;
  double max_drawdown_percentage = 22;
  double execution_time_seconds = 23;
  google.protobuf.Timestamp created_at = 24;
}

// =====================================================
// =================== RPC Messages ====================
// =====================================================


message BacktestStrategyResultStatusResponseMessage {
  uint64 strategyResultId = 1;
  uint64 mintIndex = 2;
  double pnl = 3;
  double roi = 4;
  double holdingsValue = 5;
  double winRate = 6;
  uint64 winsCount = 7;
  uint64 lossesCount = 8;
  uint64 totalTradesCount = 9;
  uint64 buyTradesCount = 10;
  uint64 sellTradesCount = 11;
}

message DeleteBacktestStrategyResultsResponseMessage {
  repeated uint64 deletedStrategyResultIds = 1;
  uint64 deletedMintResultsCount = 2;
}

message AbortBacktestRunResponseMessage {
  uint64 backtestRunId = 1;
  google.protobuf.Timestamp finishedAt = 2;
  repeated uint64 abortedStrategyResultIds = 3;
}

message DeleteBacktestRunResponseMessage {
  uint64 backtestRunId = 1;
  repeated uint64 deletedStrategyResultIds = 2;
  uint64 deletedMintResultsCount = 3;
}
